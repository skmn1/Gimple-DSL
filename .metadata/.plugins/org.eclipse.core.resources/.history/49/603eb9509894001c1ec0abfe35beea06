/*
 * generated by Xtext 2.25.0
 */
package fr.ensma.generator


import org.eclipse.emf.ecore.resource.Resource
import org.eclipse.xtext.generator.AbstractGenerator
import org.eclipse.xtext.generator.IFileSystemAccess2
import org.eclipse.xtext.generator.IGeneratorContext
import fr.ensma.gimpleDsl.fr.ensma.gimpleDsl.TAC
import java.io.FileReader
import java.util.Set
import static extension com.google.common.io.CharStreams.*
import fr.ensma.gimpleDsl.TAC

/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
class GimpleDslGenerator extends AbstractGenerator {

	override void doGenerate(Resource resource, IFileSystemAccess2 fsa, IGeneratorContext context) {
		var str = ""
		val movies = new FileReader('Z:\\Xtext\\runtime-New_configuration\\test\\test.melodymodeller').readLines
		for (String line : movies)
			str += line + "\n" 
		var model = resource.contents.head as TAC
		var content = '<functionSet>\n'
		for (Function f : model.program){
			content += '\t<function name="'+f.name+'" returns="'+f.returnedType+'">\n'
			if(f.paramName != null && f.paramType!= null){
	
				for (var i=0;i<f.paramName.length;i++)
				content += '\t\t<parameter name="'+f.paramName.get(i)+'" type="'+f.paramType.get(i)+'"/>\n'
			}
			content += '\t\t<content>'+f.content+'</content>\n\t</function>\n'
		}
		content += '</functionSet>' + '\n' + str
		
		fsa.generateFile('capellatest.xml', content)
	}
}
