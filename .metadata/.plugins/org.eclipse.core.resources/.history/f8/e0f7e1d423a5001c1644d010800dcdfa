/*
 * generated by Xtext 2.25.0
 */
package fr.ensma.generator


import org.eclipse.emf.ecore.resource.Resource
import org.eclipse.emf.ecore.resource.ResourceSet
import org.eclipse.xtext.generator.IFileSystemAccess2
import org.eclipse.xtext.generator.IGeneratorContext
import fr.ensma.gimpleDsl.Function
import java.io.File
import java.io.FileReader
import java.io.FileWriter

import fr.ensma.gimpleDsl.FunctionCall
import fr.ensma.gimpleDsl.FunctionDef
import fr.ensma.gimpleDsl.Instruction
import fr.ensma.gimpleDsl.TAC
import java.io.File
import java.io.FileReader
import java.io.FileWriter
import org.eclipse.emf.ecore.resource.Resource
import org.eclipse.xtext.generator.AbstractGenerator
import org.eclipse.xtext.generator.IFileSystemAccess2
import org.eclipse.xtext.generator.IGeneratorContext

import static extension com.google.common.io.CharStreams.*
import javax.inject.Inject
import org.eclipse.xtext.resource.IContainer
import org.eclipse.xtext.resource.IResourceDescriptions
/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
class GimpleDslGenerator implements IGimpleGenerator {
	


    override doGenerate(ResourceSet rs, IFileSystemAccess2 fsa, IGeneratorContext context) {
		val file = new File ('C:\\Users\\kamnis\\Desktop\\runtime-New_configuration\\gimple\\gimple.melodymodeller')
		val fileLines = new FileReader(file).readLines
		
		var model = rs.allContents.head as TAC
		
	    val people = rs.resources.map(r|r.allContents.toIterable.filter(Function)).flatten
	    fsa.generateFile("capella.txt", people.compile)
    }

    override afterGenerate(Resource input, IFileSystemAccess2 fsa, IGeneratorContext context) {
    }

    override beforeGenerate(Resource input, IFileSystemAccess2 fsa, IGeneratorContext context) {
    }

    override doGenerate(Resource input, IFileSystemAccess2 fsa, IGeneratorContext context) {
    }

  def compile (Iterable<Function> entities) '''
    «FOR e : entities»
    «e.name»
    «ENDFOR»
  '''

}
	
	
	
